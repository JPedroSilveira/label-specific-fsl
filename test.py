import pandas as pd
from scipy.stats.mstats import kruskal as kruskal_test
from scikit_posthocs import posthoc_dunn


def calculate_kruskal_dunn_7(decision_tree, random_forest, kruskal, relieff, lasso, lime, shap, multiple_fsl, p_value_threshold=0.01):
    result = ""
    try:
        _, p_value = kruskal_test(decision_tree, random_forest, kruskal, relieff, lasso, lime, shap, multiple_fsl)
    except ValueError as e:
        if "All numbers are identical" in str(e):
            p_value = 1.0  # No difference
        else:
            raise
    if p_value < p_value_threshold:
        result += "Significant difference detected (p < 0.01). "
        data = decision_tree + random_forest + kruskal + relieff + lasso + lime + shap + multiple_fsl
        groups = (
            ['decision_tree'] * len(decision_tree)  
            + ['random_forest'] * len(random_forest) 
            + ['kruskal'] * len(kruskal) 
            + ['relieff'] * len(relieff) 
            + ['lasso'] * len(lasso) 
            + ['lime'] * len(lime) 
            + ['shap'] * len(shap)
            + ['multiple_fsl'] * len(multiple_fsl)
        )
        df = pd.DataFrame({'value': data, 'group': groups})
        # Dunn’s test with Bonferroni correction
        dunn_results = posthoc_dunn(df, val_col='value', group_col='group', p_adjust='bonferroni')
        result += f"Dunn's post-hoc test results (p-values):\n {dunn_results}"
    else:
        result = "No significant difference (p ≥ 0.01)."
    return result

jaccard = calculate_kruskal_dunn_7(
[0.5789473684210527, 0.5789473684210527, 0.4634146341463415, 0.5384615384615384, 0.4634146341463415, 0.5384615384615384, 0.5384615384615384, 0.5384615384615384, 0.5789473684210527, 0.5789473684210527, 0.5],
[0.9354838709677419, 0.9354838709677419, 0.9354838709677419, 1.0, 0.9354838709677419, 0.9354838709677419, 0.9354838709677419, 1.0, 0.9354838709677419, 0.9354838709677419, 0.9354838709677419],
[1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
[1.0, 1.0, 1.0, 0.9354838709677419, 0.9354838709677419, 1.0, 1.0, 0.9354838709677419, 1.0, 1.0, 0.9354838709677419],
 [0.7142857142857143, 0.7142857142857143, 0.8181818181818182, 0.7142857142857143, 0.7647058823529411, 0.7647058823529411, 0.6666666666666666, 0.8181818181818182, 0.6666666666666666, 0.8181818181818182, 0.8181818181818182],
 [0.4634146341463415, 0.5, 0.36363636363636365, 0.36363636363636365, 0.36363636363636365, 0.36363636363636365, 0.36363636363636365, 0.3953488372093023, 0.36363636363636365, 0.3953488372093023, 0.3333333333333333],
  [0.7142857142857143, 0.7647058823529411, 0.6666666666666666, 0.8181818181818182, 0.7647058823529411, 0.8181818181818182, 0.7647058823529411, 0.7142857142857143, 0.7647058823529411, 0.7647058823529411, 0.7142857142857143],
  [0.9354838709677419, 0.875, 0.9354838709677419, 0.9354838709677419, 0.875, 0.875, 0.875, 0.875, 0.8181818181818182, 0.7647058823529411, 0.875]
)
print("JACCARD")
print(jaccard)

spearman = calculate_kruskal_dunn_7(
[0.27211450152146305, 0.3263057586399187, 0.32460032990555476, 0.3958401300255611, 0.305905166700117, 0.3735560954562505, 0.32532440722347217, 0.3755235635506315, 0.3355916108524786, 0.3287629991531383, 0.2663915267462696],
[0.3330775964624812, 0.30975600996610625, 0.3949608314067024, 0.4008412830239501, 0.3325020762721375, 0.3505245673497789, 0.3152221050032547, 0.36421225112792077, 0.37186774707638437, 0.26806087405445445, 0.3219698772193666],
 [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
 [0.9274588673654912, 0.9235218064689905, 0.917243608448744, 0.9313487912729232, 0.9172337321272249, 0.9356328701937106, 0.9351327691858768, 0.9276128481964491, 0.912968508002065, 0.912598594868802, 0.9258629435927365],
[0.8288562064729704, 0.8680876655360862, 0.8047227975709642, 0.7543302387605241, 0.8476709635247311, 0.8530479291687435, 0.8381844660813236, 0.8394792522049714, 0.8859383165243838, 0.860631161007667, 0.8555480958104844],
[0.1729249624026397, 0.1278498799129088, 0.16767435074409107, 0.13387533388700593, 0.08479091378420238, 0.08324706516127583, 0.24544903593634262, 0.22026486498619557, 0.18638863325177885, 0.2031878072321609, 0.15906578976902874],
[0.4504401696931606, 0.39229287782541356, 0.3924073533702947, 0.4776148683531234, 0.4277008372427106, 0.43788377365266773, 0.3407622724517968, 0.4481946533186685, 0.38475814235370703, 0.4073241902538664, 0.4556045880002693],
[0.6620508615629471, 0.6430563434663987, 0.6412611822662052, 0.5648877834065649, 0.6229832657386183, 0.6040093557864263, 0.6783660158437239, 0.6387217780863479, 0.6207317384183566, 0.6584207529536297, 0.5991255052292691]
)
print("SPEARMAN")
print(spearman)

pearson = calculate_kruskal_dunn_7(
[0.7145239439024421, 0.6960422811172761, 0.7406369078819671, 0.9196632495610069, 0.7989862449585038, 0.7658332864418295, 0.5926329127631486, 0.7469859542763293, 0.7293815374899761, 0.6350072429355904, 0.6680954442199267],
[0.9882606315568768, 0.9925572640329707, 0.9869183415692087, 0.9904402137032122, 0.9908281576043468, 0.9840677748891826, 0.9897411703146439, 0.9946014165833258, 0.9892258850191535, 0.9878236648827858, 0.9865271940324076],
[0.9999999999999999, 0.9999999999999998, 0.9999999999999998, 1.0, 1.0, 1.0, 1.0, 1.0, 0.9999999999999999, 1.0, 0.9999999999999997],
[0.9862337823790978, 0.9870010177176238, 0.9879728854895745, 0.9861440264736899, 0.9861421494459053, 0.9877906590235014, 0.9878755122986165, 0.9873529829839833, 0.9861239738493204, 0.9867512196009167, 0.9866109607796519],
[0.9901336448302597, 0.9896597537008931, 0.9893560760918829, 0.9894147255232999, 0.9894357519091014, 0.9892660789325386, 0.9892963542304937, 0.9897980030281782, 0.9895860338367113, 0.9901140716365101, 0.9883642508838181],
[0.8697160678585878, 0.8707653251923764, 0.8868797012952698, 0.8034574888162332, 0.8892482056167244, 0.8841439059231856, 0.8713460063685554, 0.9094804059173199, 0.8682582272463437, 0.8756832694660852, 0.8868891924399442],
 [0.9210171897058494, 0.9307320457875714, 0.9216840968378579, 0.9366430560311664, 0.908010256648141, 0.9079031359787934, 0.9235828830931748, 0.9089148779013687, 0.9072669084517974, 0.9279277098174884, 0.9168184466737097],
 [0.9204735, 0.90333706, 0.89852786, 0.9024591, 0.9094586, 0.90024906, 0.92255545, 0.9169673, 0.8887956, 0.9104382, 0.8972363]
)
print("PEARSON")
print(pearson)